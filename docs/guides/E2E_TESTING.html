<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playwright E2E Testing Documentation - Waqt</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <a href="../index.html" style="display: flex; align-items: center; gap: 0.5rem; text-decoration: none; color: inherit;">
                    <i class="fas fa-clock"></i>
                    <span>Waqt</span>
                </a>
            </div>
            <button class="nav-toggle" id="navToggle" aria-label="Toggle navigation menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul class="nav-menu" id="navMenu">
                <li><a href="../index.html">Home</a></li>
                <li><a href="../installation.html">Installation</a></li>
                <li><a href="../usage.html">Usage</a></li>
                <li><a href="../documentation.html" class="active">Documentation</a></li>
                <li><a href="https://github.com/GMouaad/waqt" target="_blank" rel="noopener noreferrer"><i class="fab fa-github"></i> GitHub</a></li>
            </ul>
        </div>
    </nav>

    <div class="page-header">
        <div class="container">
            <h1>Playwright E2E Testing Documentation</h1>
            <a href="../documentation.html" class="back-link"><i class="fas fa-arrow-left"></i> Back to Documentation</a>
        </div>
    </div>

    <section class="content-section">
        <div class="container documentation-content">
            <h2 id="overview">Overview</h2>
            <p>This project includes comprehensive end-to-end (E2E) browser tests using Playwright. These tests verify that the web UI works correctly across all major user flows.</p>

            <h2 id="features">Features</h2>

            <h3>✅ Implemented Features</h3>
            <ol>
                <li><strong>Playwright Integration</strong>: Full browser automation using <code>pytest-playwright</code></li>
                <li><strong>Robust Selectors</strong>: All interactive elements have <code>data-testid</code> attributes for reliable test selectors</li>
                <li><strong>Graceful Skipping</strong>: Tests automatically skip (not fail) when Playwright browsers aren't installed</li>
                <li><strong>CI/CD Integration</strong>: GitHub Actions workflow installs browsers and runs tests automatically</li>
                <li><strong>Comprehensive Coverage</strong>: 13 E2E tests covering all major user flows</li>
            </ol>

            <h2 id="test-coverage">Test Coverage</h2>

            <h3>Major User Flows Tested</h3>
            <ul>
                <li>✅ <strong>Navigation</strong>: Page loading and navigation between all sections</li>
                <li>✅ <strong>Time Entries</strong>: Adding, viewing, and deleting time entries</li>
                <li>✅ <strong>Leave Management</strong>: Adding vacation and sick leave days</li>
                <li>✅ <strong>Reports</strong>: Week/month view toggling and period navigation</li>
                <li>✅ <strong>Empty States</strong>: Proper display when no data exists</li>
                <li>✅ <strong>Form Validation</strong>: Client-side validation of required fields</li>
                <li>✅ <strong>Complete Workflows</strong>: End-to-end user journeys</li>
            </ul>

            <h2 id="running-tests">Running Tests</h2>

            <h3>Prerequisites</h3>
            <ol>
                <li><strong>Install Dependencies</strong>:
                    <pre><code>uv pip install -e ".[dev]"</code></pre>
                </li>
                <li><strong>Install Playwright Browsers</strong> (required for E2E tests):
                    <pre><code>playwright install chromium --with-deps</code></pre>
                </li>
            </ol>

            <h3>Running E2E Tests</h3>
            <p><strong>Run all E2E tests:</strong></p>
            <pre><code>pytest tests/test_e2e.py -v</code></pre>

            <p><strong>Run a specific test:</strong></p>
            <pre><code>pytest tests/test_e2e.py::test_homepage_loads -v</code></pre>

            <p><strong>Run with more verbose output:</strong></p>
            <pre><code>pytest tests/test_e2e.py -vv --tb=short</code></pre>

            <h3>Running All Tests</h3>
            <p><strong>Run all tests (unit + E2E):</strong></p>
            <pre><code>pytest tests/ -v</code></pre>

            <p><strong>Run only E2E tests:</strong></p>
            <pre><code>pytest tests/ -v -m e2e</code></pre>

            <p><strong>Run excluding E2E tests:</strong></p>
            <pre><code>pytest tests/ -v -m "not e2e"</code></pre>

            <h2 id="test-behavior">Test Behavior</h2>

            <h3>When Playwright Browsers Are Installed</h3>
            <p>Tests run normally and execute browser automation:</p>
            <pre><code>tests/test_e2e.py::test_homepage_loads PASSED                    [  7%]
tests/test_e2e.py::test_navigation PASSED                        [ 15%]
...
=============== 13 passed in 19.38s ================</code></pre>

            <h3>When Playwright Browsers Are NOT Installed</h3>
            <p>Tests skip gracefully with a helpful message:</p>
            <pre><code>tests/test_e2e.py::test_homepage_loads SKIPPED (Playwright browsers not
installed - run 'playwright install' to enable E2E tests)                [  7%]
tests/test_e2e.py::test_navigation SKIPPED (Playwright browsers not
installed - run 'playwright install' to enable E2E tests)                [ 15%]
...
=============== 13 skipped in 0.02s ================</code></pre>

            <p>This ensures that:</p>
            <ul>
                <li>Local developers without Playwright installed don't get test failures</li>
                <li>CI/CD pipelines can run tests reliably</li>
                <li>Tests fail only when there are actual issues, not missing dependencies</li>
            </ul>

            <h2 id="data-test-ids">Data Test IDs</h2>
            <p>All interactive elements have <code>data-testid</code> attributes for reliable test selection:</p>

            <h3>Navigation</h3>
            <ul>
                <li><code>navbar</code> - Main navigation bar</li>
                <li><code>logo</code> - Waqt logo</li>
                <li><code>nav-dashboard</code> - Dashboard navigation link</li>
                <li><code>nav-time-entry</code> - Time Entry navigation link</li>
                <li><code>nav-reports</code> - Reports navigation link</li>
                <li><code>nav-leave</code> - Leave navigation link</li>
                <li><code>theme-toggle</code> - Theme toggle button</li>
            </ul>

            <h3>Dashboard</h3>
            <ul>
                <li><code>dashboard</code> - Main dashboard container</li>
                <li><code>stat-weekly-hours</code> - Weekly hours stat card</li>
                <li><code>stat-overtime</code> - Overtime stat card</li>
                <li><code>stat-working-days</code> - Working days stat card</li>
                <li><code>stat-standard-hours</code> - Standard hours stat card</li>
                <li><code>btn-add-time-entry</code> - Add time entry button</li>
                <li><code>recent-entries-table</code> - Recent entries table</li>
                <li><code>entry-row-{id}</code> - Individual entry row</li>
                <li><code>btn-delete-entry-{id}</code> - Delete entry button</li>
                <li><code>empty-entries</code> - Empty state message</li>
                <li><code>action-add-time</code> - Quick action: Add time</li>
                <li><code>action-view-reports</code> - Quick action: View reports</li>
                <li><code>action-manage-leave</code> - Quick action: Manage leave</li>
            </ul>

            <h3>Time Entry Page</h3>
            <ul>
                <li><code>time-entry-page</code> - Time entry page container</li>
                <li><code>time-entry-form</code> - Time entry form</li>
                <li><code>input-date</code> - Date input field</li>
                <li><code>input-start-time</code> - Start time input</li>
                <li><code>input-end-time</code> - End time input</li>
                <li><code>input-description</code> - Description textarea</li>
                <li><code>btn-submit</code> - Submit button</li>
                <li><code>btn-cancel</code> - Cancel button</li>
            </ul>

            <h3>Reports Page</h3>
            <ul>
                <li><code>reports-page</code> - Reports page container</li>
                <li><code>period-selector</code> - Period selector controls</li>
                <li><code>btn-week-view</code> - Week view button</li>
                <li><code>btn-month-view</code> - Month view button</li>
                <li><code>date-navigator</code> - Date navigation controls</li>
                <li><code>btn-prev-period</code> - Previous period button</li>
                <li><code>btn-next-period</code> - Next period button</li>
                <li><code>current-period</code> - Current period display</li>
                <li><code>stat-total-hours</code> - Total hours stat</li>
                <li><code>stat-overtime</code> - Overtime stat</li>
                <li><code>stat-working-days</code> - Working days stat</li>
                <li><code>stat-leave-days</code> - Leave days stat (month view only)</li>
                <li><code>entries-table</code> - Time entries table</li>
                <li><code>daily-summary-table</code> - Daily summary table</li>
                <li><code>leave-days-table</code> - Leave days table</li>
                <li><code>empty-entries</code> - Empty state message</li>
            </ul>

            <h3>Leave Management Page</h3>
            <ul>
                <li><code>leave-page</code> - Leave page container</li>
                <li><code>stat-vacation-days</code> - Vacation days stat</li>
                <li><code>stat-sick-days</code> - Sick days stat</li>
                <li><code>stat-total-leave</code> - Total leave stat</li>
                <li><code>leave-form</code> - Leave form</li>
                <li><code>input-leave-date</code> - Date input</li>
                <li><code>select-leave-type</code> - Leave type selector</li>
                <li><code>input-leave-description</code> - Description input</li>
                <li><code>btn-add-leave</code> - Add leave button</li>
                <li><code>leave-history-table</code> - Leave history table</li>
                <li><code>leave-row-{id}</code> - Individual leave row</li>
                <li><code>btn-delete-leave-{id}</code> - Delete leave button</li>
                <li><code>empty-leave</code> - Empty state message</li>
            </ul>

            <h3>Flash Messages</h3>
            <ul>
                <li><code>flash-messages</code> - Flash messages container</li>
                <li><code>flash-success</code> - Success message</li>
                <li><code>flash-error</code> - Error message</li>
            </ul>

            <h2 id="cicd-integration">CI/CD Integration</h2>
            <p>The GitHub Actions workflow (<code>.github/workflows/python-ci.yml</code>) automatically:</p>
            <ol>
                <li>Installs Python dependencies including <code>pytest-playwright</code></li>
                <li>Installs Playwright chromium browser with system dependencies</li>
                <li>Runs all tests including E2E tests</li>
                <li>Reports test results</li>
            </ol>

            <h3>Workflow Steps</h3>
            <pre><code>- name: Install dependencies
  run: |
    uv pip install -e ".[dev]"

- name: Install Playwright browsers
  run: |
    playwright install chromium --with-deps

- name: Run tests
  run: |
    pytest tests/ -v --tb=short</code></pre>

            <h2 id="test-structure">Test Structure</h2>

            <h3>Fixtures (tests/conftest.py)</h3>
            <ul>
                <li><code>app</code>: Creates a test Flask application with a temporary SQLite database file</li>
                <li><code>live_server</code>: Starts a live Flask server on a random port for E2E tests</li>
                <li><code>browser_instance</code>: Creates a Playwright browser instance</li>
                <li><code>page</code>: Creates a new browser page for each test</li>
            </ul>

            <h3>Test Organization</h3>
            <p>Tests are organized by functionality:</p>
            <ul>
                <li><strong>Navigation tests</strong>: Verify page loading and navigation</li>
                <li><strong>Form tests</strong>: Test form submission and validation</li>
                <li><strong>CRUD tests</strong>: Test create, read, update, delete operations</li>
                <li><strong>UI state tests</strong>: Test empty states and conditional rendering</li>
                <li><strong>Integration tests</strong>: Test complete user workflows</li>
            </ul>

            <h2 id="best-practices">Best Practices</h2>

            <h3>Writing New E2E Tests</h3>
            <ol>
                <li><strong>Use data-testid for selectors</strong>:
                    <pre><code>page.get_by_test_id("btn-submit").click()</code></pre>
                </li>
                <li><strong>Wait for navigation</strong>:
                    <pre><code>page.wait_for_url(f"{live_server}/expected-path")</code></pre>
                </li>
                <li><strong>Mark tests with @pytest.mark.e2e</strong>:
                    <pre><code>@pytest.mark.e2e
def test_new_feature(page, live_server):
    # test code</code></pre>
                </li>
                <li><strong>Handle dialogs properly</strong>:
                    <pre><code>page.on("dialog", lambda dialog: dialog.accept())</code></pre>
                </li>
                <li><strong>Use appropriate waits</strong>:
                    <pre><code>page.wait_for_timeout(500)  # for animations
page.wait_for_selector('[data-testid="element"]')</code></pre>
                </li>
            </ol>

            <h3>Adding New data-testid Attributes</h3>
            <p>When adding new interactive elements to the UI:</p>
            <ol>
                <li>Add a descriptive <code>data-testid</code> attribute:
                    <pre><code>&lt;button data-testid="btn-save"&gt;Save&lt;/button&gt;</code></pre>
                </li>
                <li>Use consistent naming conventions:
                    <ul>
                        <li><code>btn-{action}</code> for buttons</li>
                        <li><code>input-{field}</code> for inputs</li>
                        <li><code>{element}-{descriptor}</code> for other elements</li>
                    </ul>
                </li>
                <li>Document the new test ID in this file</li>
            </ol>

            <h2 id="troubleshooting">Troubleshooting</h2>

            <h3>Tests Skip Instead of Running</h3>
            <p><strong>Problem</strong>: E2E tests show as SKIPPED</p>
            <pre><code>tests/test_e2e.py::test_homepage_loads SKIPPED</code></pre>

            <p><strong>Solution</strong>: Install Playwright browsers</p>
            <pre><code>playwright install chromium</code></pre>

            <h3>Browser Launch Errors</h3>
            <p><strong>Problem</strong>: <code>Error: BrowserType.launch: Executable doesn't exist</code></p>
            <p><strong>Solution</strong>: Install browsers with system dependencies</p>
            <pre><code>playwright install chromium --with-deps</code></pre>

            <h3>Port Already in Use</h3>
            <p><strong>Problem</strong>: Tests fail with "Address already in use"</p>
            <p><strong>Solution</strong>: The <code>live_server</code> fixture uses a random available port. This error is rare but can happen if you run tests in parallel. Run tests sequentially.</p>

            <h3>Timeouts</h3>
            <p><strong>Problem</strong>: Tests timeout waiting for elements</p>
            <p><strong>Solution</strong>:</p>
            <ol>
                <li>Increase timeout: <code>page.wait_for_timeout(5000)</code></li>
                <li>Check selector: Verify the <code>data-testid</code> exists</li>
                <li>Check server: Ensure Flask app started correctly</li>
            </ol>

            <h2 id="maintenance">Maintenance</h2>

            <h3>Updating Tests</h3>
            <p>When the UI changes:</p>
            <ol>
                <li>Update <code>data-testid</code> attributes in HTML templates if elements change</li>
                <li>Update test assertions if expected content changes</li>
                <li>Add new tests for new features</li>
                <li>Run full test suite to verify no regressions</li>
            </ol>

            <h3>Test Performance</h3>
            <p>Current E2E test execution time: ~18-20 seconds for 13 tests</p>
            <p>Optimization tips:</p>
            <ul>
                <li>Keep tests focused and minimal</li>
                <li>Avoid unnecessary waits</li>
                <li>Reuse browser instances when possible (using fixtures)</li>
                <li>Run tests in parallel (future enhancement)</li>
            </ul>

            <h2 id="resources">Resources</h2>
            <ul>
                <li><a href="https://playwright.dev/python/" target="_blank">Playwright Documentation</a></li>
                <li><a href="https://github.com/microsoft/playwright-pytest" target="_blank">pytest-playwright Plugin</a></li>
                <li><a href="https://docs.pytest.org/" target="_blank">pytest Documentation</a></li>
            </ul>
        </div>
    </section>

    <footer>
        <div class="container">
            <p>&copy; <span id="copyright-year">2024</span> Waqt Contributors. Licensed under the MIT License.</p>
            <p>Made with ❤️ by the Waqt Contributors</p>
            <div class="footer-links">
                <a href="https://github.com/GMouaad/waqt" target="_blank" rel="noopener noreferrer" aria-label="View Waqt project on GitHub"><i class="fab fa-github"></i></a>
                <a href="https://github.com/GMouaad/waqt/issues" target="_blank" rel="noopener noreferrer" aria-label="Report an issue on GitHub"><i class="fas fa-bug"></i></a>
            </div>
        </div>
    </footer>

    <script src="../js/main.js"></script>
</body>
</html>